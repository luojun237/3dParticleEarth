<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .container{
           width:500px;
           height:500px;
           background-image: linear-gradient(#ccc 1px, transparent 1px),
                           linear-gradient(90deg, #ccc 1px, transparent 1px);
           background-size: 50px 50px;
           position: relative;
        }
        .point {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            position: absolute;
            transform: translate(-50%, -50%);
            cursor: pointer;
        }
        .start {
            background: blue;
        }
        .end {
            background: green; 
        }
        .control1, .control2 {
            background: red;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <canvas id="canvas" style="border: 1px solid #000;"></canvas>
            <div class="point start" 
                :style="{left:start.x+'px',top:start.y+'px'}"
                @mousedown="startDrag('start', $event)"></div>
            <div class="point end" 
                :style="{left:end.x+'px',top:end.y+'px'}"
                @mousedown="startDrag('end', $event)"></div>
            <div class="point control1" 
                :style="{left:control1.x+'px',top:control1.y+'px'}"
                @mousedown="startDrag('control1', $event)"></div>
            <div class="point control2" 
                :style="{left:control2.x+'px',top:control2.y+'px'}"
                @mousedown="startDrag('control2', $event)"></div>
        </div>
    </div>
   
    
</body>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>

<script>
    const vm = new Vue({
        el: '#app',
        data: {
            ctx: null,
            start: { x: 100, y: 100 },
            end: { x: 300, y: 100 },
            control1: { x: 150, y: 200 },
            control2: { x: 250, y: 200 },
            dragging: null,
            animationFrameId: null,
            containerRect: null
        },
        mounted(){
            const canvas = document.getElementById('canvas');
            canvas.width = 500
            canvas.height = 500
            this.ctx = canvas.getContext('2d')
            this.drawCurve();
            
            // 获取容器的位置信息
            this.containerRect = document.querySelector('.container').getBoundingClientRect();

            document.addEventListener('mousemove', this.onDrag);
            document.addEventListener('mouseup', this.stopDrag);
        },
        beforeDestroy() {
            if(this.animationFrameId) {
                cancelAnimationFrame(this.animationFrameId);
            }
            document.removeEventListener('mousemove', this.onDrag);
            document.removeEventListener('mouseup', this.stopDrag);
        },
        methods: {
            drawCurve() {
                if(this.animationFrameId) {
                    cancelAnimationFrame(this.animationFrameId);
                }
                
                this.animationFrameId = requestAnimationFrame(() => {
                    this.ctx.clearRect(0, 0, 500, 500);
                    this.ctx.lineWidth = 2;
                    
                    // 绘制绿色圆形
                    this.ctx.beginPath();
                    this.ctx.strokeStyle = 'green';
                    this.ctx.arc(250, 250, 150, 0, 2 * Math.PI);
                    this.ctx.stroke();
                    
                    // 绘制红色贝塞尔曲线
                    this.ctx.beginPath(); 
                    this.ctx.strokeStyle = 'red';
                    this.ctx.moveTo(this.start.x, this.start.y);
                    this.ctx.bezierCurveTo(
                        this.control1.x, this.control1.y,
                        this.control2.x, this.control2.y,
                        this.end.x, this.end.y
                    );
                    this.ctx.stroke();
                });
            },
            startDrag(point, event) {
                this.dragging = point;
            },
            onDrag(event) {
                if(!this.dragging) return;
                
                // 使用相对于容器的坐标
                const x = event.clientX - this.containerRect.left;
                const y = event.clientY - this.containerRect.top;
                
                // 限制在容器范围内
                const boundedX = Math.max(0, Math.min(500, x));
                const boundedY = Math.max(0, Math.min(500, y));
                
                this[this.dragging] = { x: boundedX, y: boundedY };
                this.drawCurve();
            },
            stopDrag() {
                this.dragging = null;
            }
        }
    })
    vm.$mount()
</script>
</html>